<!DOCTYPE html>
<html>
<head>
    <title>Indoor Navigation System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        
        /* Search Header */
        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 18px;
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            max-width: 500px;
            padding: 10px 80px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .search-box button {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 6px 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-width: 500px;
            background: white;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .suggestion:hover {
            background: #f5f5f5;
        }
        
        /* Map */
        #map {
            position: absolute;
            top: 85px;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        /* Set Location Button */
        .set-location-btn {
            position: absolute;
            top: 95px;
            right: 10px;
            z-index: 1000;
            padding: 10px 15px;
            background: white;
            border: 2px solid #2196F3;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            color: #2196F3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .set-location-btn:hover {
            background: #2196F3;
            color: white;
        }
        
        /* Info Panel */
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            max-width: 300px;
            display: none;
            z-index: 1000;
        }
        
        .info-panel.show {
            display: block;
        }
        
        .info-panel h3 {
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .info-panel button {
            margin-top: 10px;
            padding: 8px 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        
        .info-panel button:hover {
            background: #1976D2;
        }
        
        .btn-close {
            background: #757575 !important;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Header with Search -->
    <div class="header">
        <h1>üó∫Ô∏è Indoor Navigation System</h1>
        <div class="search-box">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Search location (e.g., Main Entrance)..."
                autocomplete="off"
            >
            <button onclick="search()">üîç Search</button>
            <div class="suggestions" id="suggestions"></div>
        </div>
    </div>
    
    <!-- Set Current Location Button -->
    <button class="set-location-btn" onclick="setCurrentLocation()">
        üìç Set My Location
    </button>
    
    <!-- Map -->
    <div id="map"></div>
    
    <!-- Info Panel -->
    <div class="info-panel" id="infoPanel">
        <h3 id="locationName">Location</h3>
        <p id="locationDesc">Description</p>
        <button onclick="navigateTo()">üß≠ Navigate Here</button>
        <button class="btn-close" onclick="closeInfo()">Close</button>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // YOUR 4 LOCATIONS
        const locations = {
            'Main Entrance': {
                pos: [820, 1695],
                description: 'Main building entrance'
            },
            'Conference Room': {
                pos: [1992, 1955],
                description: 'Meeting and conference space'
            },
            'Computer Lab': {
                pos: [1192, 3195],
                description: 'Computer lab with workstations'
            },
            'Study Area': {
                pos: [696, 3243],
                description: 'Quiet study space'
            }
        };
        
        // Create map
        const map = L.map('map', { 
            crs: L.CRS.Simple,
            minZoom: -2,
            maxZoom: 4,
            zoom: 0
        });
        
        const bounds = [[0, 0], [3024, 4032]];
        L.imageOverlay('blueprint.png', bounds).addTo(map);
        map.fitBounds(bounds);
        
        // Variables
        let markers = {};
        let selectedLocation = null;
        let currentLocation = null;
        let currentLocationMarker = null;
        let routeLine = null;
        
        // Add markers
        Object.entries(locations).forEach(([name, data]) => {
            const marker = L.marker(data.pos).addTo(map);
            marker.bindPopup(`<b>${name}</b><br>${data.description}`);
            marker.on('click', () => showInfo(name, data));
            markers[name] = marker;
        });
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const suggestionsDiv = document.getElementById('suggestions');
        
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            
            if (query.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            const matches = Object.keys(locations).filter(name => 
                name.toLowerCase().includes(query)
            );
            
            if (matches.length > 0) {
                suggestionsDiv.innerHTML = matches.map(name => 
                    `<div class="suggestion" onclick="selectLocation('${name}')">${name}</div>`
                ).join('');
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') search();
        });
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-box')) {
                suggestionsDiv.style.display = 'none';
            }
        });
        
        function search() {
            const query = searchInput.value.trim().toLowerCase();
            const found = Object.keys(locations).find(name => 
                name.toLowerCase().includes(query)
            );
            
            if (found) {
                selectLocation(found);
            } else {
                alert('Location not found! Try: ' + Object.keys(locations).join(', '));
            }
        }
        
        function selectLocation(name) {
            const location = locations[name];
            map.setView(location.pos, 2);
            markers[name].openPopup();
            showInfo(name, location);
            suggestionsDiv.style.display = 'none';
            searchInput.value = name;
            selectedLocation = { name, ...location };
        }
        
        function showInfo(name, data) {
            document.getElementById('locationName').textContent = name;
            document.getElementById('locationDesc').textContent = data.description;
            document.getElementById('infoPanel').classList.add('show');
            selectedLocation = { name, ...data };
        }
        
        function closeInfo() {
            document.getElementById('infoPanel').classList.remove('show');
        }
        
        // Set current location
        function setCurrentLocation() {
            alert('Click on the map where you are right now');
            
            map.once('click', function(e) {
                currentLocation = [e.latlng.lat, e.latlng.lng];
                
                if (currentLocationMarker) {
                    map.removeLayer(currentLocationMarker);
                }
                
                currentLocationMarker = L.circleMarker(currentLocation, {
                    radius: 12,
                    fillColor: '#2196F3',
                    color: 'white',
                    weight: 3,
                    opacity: 1,
                    fillOpacity: 0.9
                }).addTo(map);
                
                currentLocationMarker.bindPopup('<b>üìç You are here</b>').openPopup();
                console.log('Current location set:', currentLocation);
            });
        }
        
        // Navigate
        function navigateTo() {
            if (!selectedLocation) {
                alert('Please select a destination first!');
                return;
            }
            
            let start;
            if (currentLocation) {
                start = currentLocation;
            } else {
                alert('‚ö†Ô∏è Please set your current location first!\n\nClick "Set My Location" button.');
                return;
            }
            
            if (routeLine) {
                map.removeLayer(routeLine);
            }
            
            const end = selectedLocation.pos;
            
            routeLine = L.polyline([start, end], {
                color: '#2196F3',
                weight: 6,
                opacity: 0.9,
                dashArray: '15, 10'
            }).addTo(map);
            
            routeLine.bindPopup(`Route to ${selectedLocation.name}`);
            
            map.fitBounds([start, end], { padding: [80, 80], maxZoom: 2 });
            
            alert(`üß≠ Navigation started!\n\nDestination: ${selectedLocation.name}\n\nFollow the BLUE dashed line.`);
        }
        
        // Click for coordinates
        map.on('click', function(e) {
            console.log('Position:', Math.round(e.latlng.lat), Math.round(e.latlng.lng));
        });
        
        console.log('‚úÖ Map ready!', Object.keys(locations).length, 'locations loaded');
    </script>
</body>
</html>
